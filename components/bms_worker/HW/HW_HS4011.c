/**
 * @file HW_HS4011.c
 * @brief  Source file for HS4011 Relative Humidty/Temperature Sensor
 * @author Joshua Lafleur (josh.lafleur@outlook.com)
 * @version 
 * @date 2023-12-19
 */

/******************************************************************************
 *                             I N C L U D E S
 ******************************************************************************/

#include "HW_HS4011.h"

#include "HW_i2c.h"

#include "Utility.h"
#include "include/ErrorHandler.h"

/******************************************************************************
 *                              D E F I N E S
 ******************************************************************************/

/******************************************************************************
 *                              E X T E R N S
 ******************************************************************************/

extern HW_I2C_Handle_T i2c2;


/******************************************************************************
 *                             T Y P E D E F S
 ******************************************************************************/

/******************************************************************************
 *                               M A C R O S
 ******************************************************************************/

/******************************************************************************
 *                           P U B L I C  V A R S
 ******************************************************************************/

/******************************************************************************
 *            P U B L I C  F U N C T I O N  P R O T O T Y P E S
 ******************************************************************************/

/******************************************************************************
 *                         P R I V A T E  V A R S
 ******************************************************************************/

HW_I2C_Device_S HS4011 = {
  .addr = 0x54,
  .handle = &i2c2,
};


/******************************************************************************
 *          P R I V A T E  F U N C T I O N  P R O T O T Y P E S
 ******************************************************************************/


/******************************************************************************
 *                       P U B L I C  F U N C T I O N S
 ******************************************************************************/

bool HS4011_Init()
{
    
    uint8_t wdat = 0xD7;
    uint8_t rdat[5] = {0}; 

    if (HAL_I2C_Master_Transmit(&i2c2, 0x54 << 1, &wdat, 1, 1000) != HAL_OK)
    {
        // Error_Handler();
    }

    HAL_I2C_Master_Receive(&i2c2, 0x54 << 1, (uint8_t*) &rdat, 5, 1000);
    
    if ((uint32_t) rdat != 0x00)
    {
        // Error_Handler();
    }
    return true; 
}

/******************************************************************************
 *                     P R I V A T E  F U N C T I O N S
 ******************************************************************************/
