/**
 * @file HW_SHT40.c
 * @brief  Source code for SHT40 Driver
 * @author Joshua Lafleur (josh.lafleur@outlook.com)
 * @date 2024-01-19
 */

#if defined (BMSW_BOARD_VA3)

/******************************************************************************
 *                             I N C L U D E S
 ******************************************************************************/

#include "HW_SHT40.h"


/******************************************************************************
 *                              D E F I N E S
 ******************************************************************************/
#define READ_SENSOR_ID 0x89

/******************************************************************************
 *                              E X T E R N S
 ******************************************************************************/

extern HW_I2C_Handle_T i2c2;

/******************************************************************************
 *                             T Y P E D E F S
 ******************************************************************************/

/******************************************************************************
 *                               M A C R O S
 ******************************************************************************/

/******************************************************************************
 *                           P U B L I C  V A R S
 ******************************************************************************/

/******************************************************************************
 *                         P R I V A T E  V A R S
 ******************************************************************************/

HW_I2C_Device_S SHT40 = {
    .addr   = 0x44,
    .handle = &i2c2,
};

SHT40_S sht_chip = {
    .dev = &SHT40,
};


/******************************************************************************
 *          P R I V A T E  F U N C T I O N  P R O T O T Y P E S
 ******************************************************************************/

/******************************************************************************
 *                       P U B L I C  F U N C T I O N S
 ******************************************************************************/

bool SHT40_Init(void)
{
    uint8_t wdat    = READ_SENSOR_ID;
    uint8_t rdat[6] = { 0 };

    if (!HW_I2C_Master_Write(sht_chip.dev, &wdat, 1, 1000))
    {
        return false;
    }

    if (!HW_I2C_Master_Read(sht_chip.dev, (uint8_t*)&rdat, 6, 1000))
    {
        return false;
    }

    sht_chip.serial_number = ((uint32_t) rdat[0]) | ((uint32_t) rdat[1] << 8) | ((uint32_t) rdat[2] << 16) | ((uint32_t) rdat[3] << 24);

    return true;
}

bool SHT40_StartConversion(void)
{
    return true;
}

bool SHT40_GetData(void)
{
    return true;
}

bool SHT40_StartHeather(void)
{
    return true;
}


/******************************************************************************
 *                     P R I V A T E  F U N C T I O N S
 ******************************************************************************/

#endif
